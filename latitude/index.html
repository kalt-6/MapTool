<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, interactive-widget=resizes-content">
    <meta name="description" content="Compare the latitude of different cities on a global map.">
    <title>Latitude Comparator</title>
    
    <link rel="icon" type="image/png" href="logo.png">

    <!-- Performance Preconnects -->
    <link rel="preconnect" href="https://cdn.tailwindcss.com">
    <link rel="preconnect" href="https://unpkg.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://basemaps.cartocdn.com">
    <link rel="preconnect" href="https://nominatim.openstreetmap.org">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>
     
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

    <style>
        /* Core Layout & iOS Fixes */
        html, body { 
            font-family: 'Inter', sans-serif; margin: 0; padding: 0; 
            width: 100%; height: 100%; overflow: hidden; position: fixed; 
            overscroll-behavior: none; -webkit-overflow-scrolling: touch;
        }
        #map { height: 100%; width: 100%; position: absolute; top: 0; left: 0; z-index: 1; background-color: #111; }
        
        /* UI Components */
        .glass-panel {
            background: rgba(0, 0, 0, 0.85); backdrop-filter: blur(12px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.8), 0 2px 4px -1px rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.15); transition: all 0.3s ease;
        }
        
        /* Leaflet Customization */
        .leaflet-bar a { background-color: #0a0a0a !important; color: #e5e5e5 !important; border-bottom: 1px solid #262626 !important; }
        .leaflet-bar a:hover { background-color: #262626 !important; }
        .leaflet-container .leaflet-control-attribution {
            background: rgba(0, 0, 0, 0.6) !important; color: #666 !important; font-size: 11px; border-radius: 4px 0 0 0;
        }
        .leaflet-container .leaflet-control-attribution a { color: #888 !important; text-decoration: none; }
        .leaflet-container .leaflet-control-attribution a:hover { color: #ccc !important; text-decoration: underline; }
        .leaflet-popup-content-wrapper, .leaflet-popup-tip {
            background: #0a0a0a !important; color: #f5f5f5 !important; border: 1px solid #333 !important;
        }
        .custom-pin { background: transparent; border: none; }
        
        @media (max-width: 768px) { .leaflet-control-zoom { display: none !important; } }

        /* Animation & Loader */
        .rotate-180 { transform: rotate(180deg); }
        .loader {
            border: 2px solid #e5e5e5; border-top: 2px solid #10b981; /* Emerald for Latitude */
            border-radius: 50%; width: 12px; height: 12px; animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Responsive Panel Positioning */
        .panel-position {
            position: absolute; left: 1rem; width: calc(100% - 2rem); max-width: 24rem; 
            z-index: 1000; pointer-events: none; transition: all 0.3s ease;
            bottom: calc(0.5rem + env(safe-area-inset-bottom)); top: auto;
        }
        @media (min-width: 1024px) {
            .panel-position { top: 1rem; bottom: auto; width: 24rem; }
        }
    </style>
</head>
<body class="bg-black">

    <div id="map"></div>

    <div class="panel-position">
        <div class="glass-panel rounded-xl p-3 md:p-4 pointer-events-auto shadow-2xl overflow-hidden">
            
            <!-- Header -->
            <div class="flex items-center justify-between mb-0">
                <div class="flex items-center gap-2 overflow-hidden">
                    <div class="p-1.5 bg-neutral-800 rounded-lg shrink-0">
                        <!-- Latitude Icon -->
                        <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    </div>
                    <div class="flex flex-col">
                        <h1 class="text-sm md:text-base font-bold text-white truncate leading-tight">Latitude Comparator</h1>
                        <span id="headerLat" class="text-xs md:text-sm font-bold text-emerald-400 font-mono hidden">0.00°</span>
                    </div>
                </div>
                
                <div class="flex items-center gap-2">
                    <button onclick="resetMap()" aria-label="Reset Map" class="text-[10px] font-bold text-neutral-400 border border-neutral-600 md:hover:border-red-500 md:hover:text-red-500 md:hover:bg-red-900/20 active:border-red-500 active:text-red-500 active:bg-red-900/20 px-2 py-1 rounded transition-all">
                        Reset
                    </button>
                    <button onclick="togglePanel()" id="toggleBtn" aria-label="Toggle Panel" class="p-1 text-neutral-400 md:hover:text-white md:hover:bg-neutral-700/50 active:text-white active:bg-neutral-700/50 rounded transition-all">
                        <svg id="chevronIcon" class="w-5 h-5 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path></svg>
                    </button>
                </div>
            </div>

            <!-- Content -->
            <div id="panelContent" class="transition-all duration-300 ease-in-out max-h-[60vh] md:max-h-[500px] overflow-y-auto opacity-100 mt-3 md:mt-4">
                
                <!-- Search Input -->
                <div class="mb-4 relative group">
                    <!-- Emerald Dot -->
                    <div class="absolute left-3.5 top-1/2 -translate-y-1/2 w-2 h-2 rounded-full bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.6)]"></div>
                    
                    <!-- Input with Emerald Focus Ring -->
                    <input type="text" id="searchInput" aria-label="Search City" placeholder="Enter city (e.g. Paris)" class="w-full pl-8 pr-20 py-2.5 bg-neutral-900/50 border border-neutral-700 rounded-lg focus:outline-none focus:ring-1 focus:ring-emerald-500 focus:border-emerald-500 transition-all text-base text-white placeholder-neutral-500 focus:bg-neutral-900">
                    
                    <!-- Find Button (Fixed Dimensions) -->
                    <!-- FIXED: Added w-[52px] h-[26px] for rigid shape stability. Removed inline onclick. Changed type to button. -->
                    <button type="button" id="searchBtn" aria-label="Find Location" class="absolute right-2 top-1/2 -translate-y-1/2 bg-white hover:bg-neutral-200 text-black text-xs font-bold rounded-md transition-colors flex items-center justify-center shadow-lg shadow-black/20 w-[52px] h-[26px]">Find</button>
                </div>

                <!-- Result Info -->
                <div id="resultPanel" class="pt-3 md:pt-4 border-t border-white/10" aria-live="polite">
                    <div class="flex justify-between items-center">
                        <h2 class="text-xs font-bold text-neutral-400 uppercase tracking-wide">Latitude</h2>
                        <!-- FIXED: Changed select-none to select-text to allow copying -->
                        <div class="flex items-center gap-2 text-sm font-bold text-white bg-neutral-800 border border-neutral-700 px-3 py-1.5 rounded-lg select-text font-mono">
                            <span id="latText">0.00°</span>
                        </div>
                    </div>
                </div>
                
                <!-- Error -->
                <div id="errorMessage" role="alert" class="hidden mt-3 text-xs text-red-400 bg-red-950/30 p-2 rounded border border-red-900/50 flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    <span id="errorText">Location not found.</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        const CONFIG = {
            ZOOM: 2,
            TILE: 'https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png',
            MAX_BOUNDS: [[-85, -Infinity], [85, Infinity]]
        };
        
        // UPDATED: Exact pin shape from measure.html, but white with a dark stroke
        const whiteIcon = L.divIcon({
            className: '', // Ensures no default white square background
            html: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="36" height="36" fill="white" stroke="#111" stroke-width="1.5" style="filter: drop-shadow(0 2px 3px rgba(0,0,0,0.4));"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>`,
            iconSize: [36, 36], 
            iconAnchor: [18, 36], 
            popupAnchor: [0, -36]
        });

        let map, currentLayerGroup;
        const els = {};
        let errorTimeout, isPanelOpen = true;

        document.addEventListener('DOMContentLoaded', () => {
            ['searchInput', 'searchBtn', 'latText', 'errorMessage', 'errorText', 
             'panelContent', 'chevronIcon', 'headerLat'].forEach(id => els[id] = document.getElementById(id));
            
            initMap();
            setupEvents();
            updateIconState();
            
            window.addEventListener('resize', () => {
                updateIconState();
                if (window.scrollY > 0) window.scrollTo(0, 0);
            });
        });

        function initMap() {
            map = L.map('map', {
                worldCopyJump: true, minZoom: 2, zoomControl: false,
                maxBounds: CONFIG.MAX_BOUNDS, maxBoundsViscosity: 1.0
            }).setView([20, 0], CONFIG.ZOOM);

            L.tileLayer(CONFIG.TILE, { attribution: '&copy; OpenStreetMap &copy; CARTO', subdomains: 'abcd', maxZoom: 20 }).addTo(map);
            L.control.zoom({ position: 'bottomright' }).addTo(map);
            currentLayerGroup = L.layerGroup().addTo(map);
        }

        // --- UI Logic ---
        function togglePanel() {
            isPanelOpen = !isPanelOpen;
            const mobile = window.innerWidth < 1024;
            
            if (isPanelOpen) {
                Object.assign(els.panelContent.style, {
                    maxHeight: mobile ? '60vh' : '500px', opacity: '1',
                    marginTop: mobile ? '0.75rem' : '1rem', marginBottom: '0'
                });
                els.headerLat.classList.add('hidden');
            } else {
                Object.assign(els.panelContent.style, {
                    maxHeight: '0', opacity: '0', marginTop: '0', marginBottom: '0'
                });
                if (els.latText.textContent !== "0.00°") {
                    els.headerLat.textContent = els.latText.textContent;
                    els.headerLat.classList.remove('hidden');
                }
            }
            updateIconState();
        }

        function updateIconState() {
            const isMobile = window.innerWidth < 1024;
            const shouldRotate = isPanelOpen ? isMobile : !isMobile;
            els.chevronIcon.classList.toggle('rotate-180', shouldRotate);
        }

        function setupEvents() {
            els.searchBtn.addEventListener('click', handleSearch);
            els.searchInput.addEventListener('keydown', (e) => e.key === 'Enter' && handleSearch());
        }

        // --- Core Application Logic ---
        async function handleSearch() {
            const q = els.searchInput.value.trim();
            if (!q) return;

            const originalText = els.searchBtn.innerText;
            els.searchBtn.innerHTML = '<div class="loader"></div>';
            els.searchBtn.disabled = true;
            els.errorMessage.classList.add('hidden');

            try {
                const res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(q)}&limit=1`);
                const data = await res.json();

                if (data?.[0]) {
                    const { lat, lon, display_name } = data[0];
                    const nLat = parseFloat(lat), nLon = parseFloat(lon);
                    const name = display_name.split(',')[0];

                    updateMap(nLat, nLon, name);
                    
                    // Keep city name in search box to indicate active state
                    els.searchInput.value = name;
                } else {
                    showError('Location not found.');
                }
            } catch (e) { showError('Search failed.'); } 
            finally { els.searchBtn.innerText = originalText; els.searchBtn.disabled = false; }
        }

        function updateMap(lat, lon, name) {
            currentLayerGroup.clearLayers();
            
            // Draw Latitude Line
            L.polyline([[lat, -360], [lat, 360]], { 
                color: '#10b981', // Emerald green
                weight: 2, 
                opacity: 0.8, 
                dashArray: '5, 10' 
            }).addTo(currentLayerGroup);

            // Draw Marker
            L.marker([lat, lon], { icon: whiteIcon })
                .bindPopup(`<b>${name}</b><br>Lat: ${lat.toFixed(4)}`)
                .openPopup()
                .addTo(currentLayerGroup);

            // Update UI
            els.latText.textContent = lat.toFixed(4) + '°';
            
            // View Update
            map.setView([lat, lon], 5, { animate: true });
        }

        function showError(msg) {
            if (errorTimeout) clearTimeout(errorTimeout);
            els.errorText.textContent = msg;
            els.errorMessage.classList.remove('hidden');
            errorTimeout = setTimeout(() => els.errorMessage.classList.add('hidden'), 3000);
        }

        function resetMap() {
            if (errorTimeout) clearTimeout(errorTimeout);
            els.errorMessage.classList.add('hidden');
            els.searchInput.value = '';
            
            currentLayerGroup.clearLayers();
            els.latText.textContent = "0.00°";
            
            map.setView([20, 0], CONFIG.ZOOM);
            if (!isPanelOpen) togglePanel();
        }
    </script>
</body>
</html>
